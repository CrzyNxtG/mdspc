### 5.27.1 General

The MAC entity may be configured by RRC with SDT and the SDT procedure
may be initiated by RRC layer for MO-SDT or MT-SDT. The SDT procedure
initiated for MO-SDT can be performed either by Random Access procedure
with 2-step RA type or 4-step RA type (i.e., RA-SDT) or by configured
grant Type 1 (i.e., CG-SDT). The SDT procedure initiated for MT-SDT
cannot be performed by RA-SDT (i.e., RA-SDT is not applicable as
specified in clause 5.1.1b), but can be performed either by Random
Access procedure (i.e., with 2-step RA type or 4-step RA type) or by
configured grant Type 1 (i.e., CG-SDT).

RRC configures the following parameters for SDT procedure:

\- *sdt-DataVolumeThreshold*: data volume threshold for the UE to
determine whether to perform SDT procedure initiated for MO-SDT;

\- *sdt-RSRP-Threshold*: RSRP threshold for UE to determine whether to
perform SDT procedure initiated for MO-SDT;

\- *mt-SDT-RSRP-Threshold*: RSRP threshold for UE to determine whether
to perform SDT procedure initiated for MT-SDT;

\- *cg-SDT-RSRP-ThresholdSSB*: an RSRP threshold configured for SSB
selection for CG-SDT;

*- cg-MT-SDT-MaxDurationToNextCG-Occasion*: time threshold which is used
by the UE to determine whether to perform CG-SDT for MT-SDT;

\- *cg-SDT-MaxDurationToNextCG-Occasion*: time threshold configured per
logical channel which is used by the UE to determine whether to perform
CG-SDT for MO-SDT;

*- sdt-BeamFailureRecoveryProhibitTimer*: prohibit timer to avoid
frequent triggering of Random Access procedure due to beam failure
recovery during RA-SDT procedure or during MT-SDT procedure initiated by
Random Access procedure.

The following UE variable is used for the SDT procedure:

\- *MAX_DURATION_TO_NEXT_CG_OCCASION*;

\- *RSRP_THRESHOLD*.

The MAC entity shall, if initiated by the upper layers for SDT
procedure:

1\> if SDT procedure is initiated for MO-SDT as specified in TS 38.331
\[5\]:

2\> set the *MAX_DURATION_TO_NEXT_CG_OCCASION* to the shortest value of
*cg-SDT-MaxDurationToNextCG-Occasion,* if configured, among all the
logical channels configured with this parameter by upper layer and
having data for transmission;

2\> set the *RSRP_THRESHOLD* to the value of *sdt-RSRP-Threshold,* if
configured.

1\> else if SDT procedure is initiated for MT-SDT as specified in TS
38.331 \[5\]:

2\> set the *MAX_DURATION_TO_NEXT_CG_OCCASION* to the value of
*cg-MT-SDT-MaxDurationToNextCG-Occasion,* if configured;

2\> if *mt-SDT-RSRP-Threshold* is configured:

3\> set the *RSRP_THRESHOLD* to the value of *mt-SDT-RSRP-Threshold.*

2\> else if *sdt-RSRP-Threshold* is configured:

3\> set the *RSRP_THRESHOLD* to the value of *sdt-RSRP-Threshold*.

1\> if the SDT procedure is initiated for MO-SDT as specified in TS
38.331 \[5\], and the data volume of the pending UL data across all RBs
configured for SDT is less than or equal to *sdt-DataVolumeThreshold*,
or if the SDT procedure is initiated for MT-SDT as specified in TS
38.331 \[5\]; and

NOTE 1: For SDT procedure, the MAC entity also considers the suspended
RBs configured with SDT for data volume calculation. It is up to the
UE\'s implementation how the UE calculates the data volume for the
suspended RBs. Size of the CCCH message is not considered for data
volume calculation

1\> if the RSRP of the downlink pathloss reference is higher than
*RSRP_THRESHOLD* or if *RSRP_THRESHOLD* is not set:

2\> if the Serving Cell is configured with supplementary uplink as
specified in TS 38.331 \[5\]; and

2\> if the RSRP of the downlink pathloss reference is less than
*rsrp-ThresholdSSB-SUL*:

3\> select the SUL carrier.

2\> else:

3\> select the NUL carrier.

2\> if CG-SDT is configured on the selected UL carrier, and TA for
CG-SDT is valid according to clause 5.27.2 in the first available CG
occasion for initial CG-SDT transmission with CCCH message according to
clause 5.8.2; and

2\> if the SDT procedure is initiated for MO-SDT as specified in TS
38.331 \[5\], and, for each RB having data available for transmission,
*configuredGrantType1Allowed*, if configured for CG-SDT, is configured
with value *true* for the corresponding logical channel, or if the SDT
procedure is initiated for MT-SDT as specified in TS 38.331 \[5\]; and

2\> if at least one SSB configured for CG-SDT with SS-RSRP above
*cg-SDT-RSRP-ThresholdSSB* is available, and if either the time gap
between the initiation of the SDT procedure and first available CG
occasion for initial CG-SDT transmission with CCCH message according to
clause 5.8.2 is less than *MAX_DURATION_TO_NEXT_CG_OCCASION*, or if the
*MAX_DURATION_TO_NEXT_CG_OCCASION* is not set:

3\> indicate to the upper layers that the conditions for initiating SDT
procedure are fulfilled;

3\> perform CG-SDT procedure on the selected UL carrier according to
clause 5.8.2.

2\> else if a set of Random Access resources for RA-SDT is configured
and can be selected according to clause 5.1.1b on the selected UL
carrier on the BWP configured by *initialUplinkBWP-RedCap*, if
configured for an (e)RedCap UE; otherwise, on the BWP configured by
*initialUplinkBWP*; or

2\> if the SDT procedure is initiated for MT-SDT as specified in TS
38.331 \[5\]:

3\> if *cg-SDT-TimeAlignmentTimer* is running, consider
*cg-SDT-TimeAlignmentTimer* as expired and perform the corresponding
actions in clause 5.2;

3\> indicate to the upper layers that the conditions for initiating SDT
procedure are fulfilled.

2\> else:

3\> indicate to the upper layers that the conditions for initiating SDT
procedure are not fulfilled.

1\> else:

2\> indicate to the upper layers that the conditions for initiating SDT
procedure are not fulfilled.

If Random Access procedure is selected above for SDT procedure initiated
for MO-SDT or MT-SDT and after the Random Access procedure is
successfully completed (see clause 5.1.6), the UE monitors PDCCH
addressed to C-RNTI received in random access response until the SDT
procedure is terminated. If CG-SDT is selected above and after the
initial transmission for CG-SDT is performed, the UE monitors PDCCH
addressed to C-RNTI as stored in UE Inactive AS context as specified in
TS 38.331 \[5\] and CS-RNTI until the SDT procedure is terminated.

The MAC entity shall:

1\> if *sdt-BeamFailureRecoveryProhibitTimer* is configured and not
running; and

1\> if RA-SDT procedure for MO-SDT or MT-SDT procedure initiated by
Random Access procedure is ongoing:

2\> if SS-RSRP of the SSB selected in the last successfully completed
Random Access procedure during ongoing RA-SDT procedure or ongoing
MT-SDT procedure initiated by Random Access procedure is less than
*rsrp-ThresholdSSB*:

3\> start the *sdt-BeamFailureRecoveryProhibitTimer*;

3\> initiate a Random Access procedure (see clause 5.1).

NOTE 1a: It is up to UE implementation when to measure SSBs during
ongoing RA-SDT procedure or ongoing MT-SDT procedure initiated by Random
Access procedure. Based on implementation the UE need not initiate the
Random Access procedure if there is no SSB with SS-RSRP above
*rsrp-ThresholdSSB*. The UE uses *rsrp-ThresholdSSB* in Random Access
configuration selected by the UE when RA-SDT or MT-SDT procedure was
initiated.

NOTE 2: When the UE determines if there is an SSB with SS-RSRP above
*cg-SDT-RSRP-ThresholdSSB* or less than *rsrp-ThresholdSSB*, the UE uses
the latest unfiltered L1-RSRP measurement.