### 5.8.3 Sidelink

There are two types of transmission without dynamic sidelink grant:

\- configured grant Type 1 where an sidelink grant is provided by RRC,
and stored as configured sidelink grant;

\- configured grant Type 2 where an sidelink grant is provided by PDCCH,
and stored or cleared as configured sidelink grant based on L1
signalling indicating configured sidelink grant activation or
deactivation.

Type 1 and/or Type 2 are configured with a single BWP. Multiple
configurations of up to 8 configured grants (including both Type 1 and
Type 2, if configured) can be active simultaneously on the BWP.

RRC configures the following parameters when the configured grant Type 1
is configured, as specified in TS 38.331 \[5\] or TS 36.331 \[21\]:

\- *sl-ConfigIndexCG*/*sl-PRS-ConfigIndexCG*: the identifier of a
configured grant for sidelink;

\- *sl-CS-RNTI*: SL-CS-RNTI for retransmission;

\- *sl-NrOfHARQ-Processes*: the number of HARQ processes for configured
grant;

\- *sl-PeriodCG/sl-PRS-PeriodCG*: periodicity of the configured grant
Type 1;

\- *sl-TimeOffsetCG-Type1*: Offset of a resource with respect to
reference logical slot defined by *sl-TimeReferenceSFN-Type1* in time
domain, referring to the number of logical slots in a resource pool;

\- *sl-TimeResourceCG-Type1*: time resource location of the configured
grant Type 1;

\- *sl-CG-MaxTransNumList*: the maximum number of times that a TB can be
transmitted using the configured grant;

*- sl-HARQ-ProcID-offset*: offset of HARQ process for configured grant
Type 1;

\- *sl-TimeReferenceSFN-Type1*: SFN used for determination of the offset
of a resource in time domain. If it is present, the UE uses the first
logical slot of associated resource pool after the starting time of the
closest SFN with the indicated number preceding the reception of the
sidelink configured grant configuration Type 1 as reference logical
slot. If it is absent, the indicated reference SFN is zero.

RRC configures the following parameters when the configured grant Type 2
is configured, as specified in TS 38.331 \[5\]:

\- *sl-ConfigIndexCG*/*sl-PRS-ConfigIndexCG*: the identifier of a
configured grant for sidelink;

\- *sl-CS-RNTI*: SL-CS-RNTI for activation, deactivation, and
retransmission;

\- *sl-PRS-CS-RNTI*: SL-PRS-CS-RNTI for activation, and deactivation;

\- *sl-NrOfHARQ-Processes*: the number of HARQ processes for configured
grant;

\- *sl-PeriodCG/sl-PRS-PeriodCG*: periodicity of the configured grant
Type 2;

\- *sl-CG-MaxTransNumList*: the maximum number of times that a TB can be
transmitted using the configured grant;

*- sl-HARQ-ProcID-offset*: offset of HARQ process for configured grant
Type 2.

Upon configuration of a configured grant Type 1, the MAC entity shall
for each configured sidelink grant:

1\> store the sidelink grant provided by RRC as a configured sidelink
grant;

1\> if the configured sidelink grant is not on Dedicated SL-PRS resource
pool:

2\> initialise or re-initialise the configured sidelink grant to
determine PSCCH duration(s) and PSSCH duration(s) and SL-PRS
transmission occasion(s), if available, according to
*sl-TimeOffsetCG-Type1* and *sl-TimeResourceCG-Type1*, and to reoccur
with *sl-periodCG* for transmissions of multiple MAC PDUs and SL-PRS(s)
according to clause 8.1.2 of TS 38.214 \[7\].

1\> if the configured sidelink grant is on Dedicated SL-PRS resource
pool:

2\> initialise or re-initialise the configured sidelink grant to
determine PSCCH duration(s) and SL-PRS transmission occasion(s)
according to *sl-TimeOffsetCG-Type1* and *sl-TimeResourceCG-Type1*, and
to reoccur with *sl-PRS-periodCG* for transmissions of multiple
SL-PRS(s) according to clause 8.2.4 of TS 38.214 \[7\].

NOTE 1: If the MAC entity is configured with multiple configured
sidelink grants, collision among the configured sidelink grants may
occur. How to handle the collision is left to UE implementation.

After a sidelink grant is configured for a configured grant Type 1, the
MAC entity shall consider sequentially that the first slot of the S^th^
sidelink grant occurs in the logical slot for which:

CURRENT_slot = (*sl-ReferenceSlotCG-Type1* + *sl-TimeOffsetCG-Type1* + S
× *PeriodicitySL*) modulo T\'~max~

where CURRENT_slot refers to current logical slot in the associated
resource
pool,$\ PeriodicitySL = \left\lceil \frac{{T'}_{\max}\ }{10240\ ms} \times sl\text{-}PeriodCG \right\rceil$
or
$PeriodicitySL = \left\lceil \frac{{T'}_{\max}\ }{10240\ ms} \times sl\text{-}\text{PRS-}PeriodCG \right\rceil$
and T\'~max~ is the number of slots that belongs to the associated
resource pool as defined in clause 8 of TS 38.214\[7\].
*sl-ReferenceSlotCG-Type1* refers to reference logical slot defined by
*sl-TimeReferenceSFN-Type1*.

After a sidelink grant is configured for a configured grant Type 2, the
MAC entity shall consider sequentially that the first slot of S^th^
sidelink grant occurs in the logical slot for which:

CURRENT_slot = (*sl-StartSlotCG-Type2* + S × *PeriodicitySL*) modulo
T\'~max~

where *sl-StartSlotCG-Type2* refers to the logical slot of the first
transmission opportunity of PSSCH or SL-PRS where the configured
sidelink grant was (re)initialised.

When a configured sidelink grant is released by RRC, all the
corresponding configurations shall be released and all corresponding
sidelink grants shall be cleared.

The MAC entity shall:

1\> if the configured sidelink grant confirmation has been triggered and
not cancelled; and

1\> if the MAC entity has UL resources allocated for new transmission:

2\> instruct the Multiplexing and Assembly procedure to generate a
Sidelink Configured Grant Confirmation MAC CE as defined in clause
6.1.3.34;

2\> cancel the triggered configured sidelink grant confirmation.

For a configured grant Type 2, the MAC entity shall clear the
corresponding configured sidelink grant immediately after first
transmission of Sidelink Configured Grant Confirmation MAC CE triggered
by the configured sidelink grant deactivation.