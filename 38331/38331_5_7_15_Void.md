### 5.7.15 Void

[]{#_Toc46480779 .anchor}5.7.16 Application layer measurement reporting

[]{#_Toc20487057 .anchor}5.7.16.1 General

![](media/image48.emf)

Figure 5.7.16.1-1: Application layer measurement reporting

The purpose of this procedure is to send application layer measurement
reports to the network.

[]{#_Toc20487058 .anchor}5.7.16.2 Initiation

A UE capable of application layer measurement reporting in RRC_CONNECTED
may initiate the procedure when configured with application layer
measurement and reporting, i.e. when at least one *measConfigAppLayer*
and SRB4 and/or SRB5 have been configured by the network.

Upon initiating the procedure, the UE shall:

1\> for each stored application layer measurement configuration with
*appLayerIdleInactiveConfig* configured and for which
*appLayerIdleInactiveConfig* has not been transmitted since the UE
received the *RRCSetup* message*:*

2\> set the parameters in *appLayerIdleInactiveConfig* in the
*MeasurementReportAppLayer* message to the values stored in the UE
variable *VarAppLayerIdleConfig*;

2\> if the *transmissionOfSessionStartStop* is set to *true*:

3\> if a session start or stop indication has been received from upper
layers:

4\> set the *appLayerSessionStatus* in the *MeasurementReportAppLayer*
message to the value of the latest received session start or stop
indication;

3\> else:

4\> set the *appLayerSessionStatus* in the *MeasurementReportAppLayer*
message to *stop*;

1\> for each *measConfigAppLayerId* with an application layer
measurement report container which has not been transmitted since the UE
received the *RRCSetup* message:

2\> if the application layer measurement reporting has not been
suspended for the *measConfigAppLayerId* associated with the application
layer measurement report container according to clause 5.3.5.13d:

3\> set the *measConfigAppLayerId* in a *MeasReportAppLayer* in the
*MeasurementReportAppLayer* message(s) to the value of the
*measConfigAppLayerId* received together with the application layer
measurement report container;

3\> for each application measurement report container stored for that
*measConfigAppLayerId*:

4\> set the *measReportAppLayerContainerList* in the
*MeasurementReportAppLayer* message(s) to the stored value of the
application layer measurement report container;

NOTE 0: If the size of the application layer measurement configurations,
session status indications and reports exceed the size of an RRC
message, the UE includes the *appLayerIdleInactiveConfig* and
corresponding *appLayerSessionStatus* in the first
*MeasurementReportAppLayer* message after the UE received the *RRCSetup*
message, and transmits application layer measurement report containers
in the same and subsequent *MeasurementReportAppLayer* messages.

1\> for each *measConfigAppLayerId* received from upper layers:

2\> if the UE AS has received application layer measurement report
container from upper layers which has not been transmitted; and

2\> if the application layer measurement reporting has not been
suspended for the *measConfigAppLayerId* associated with the application
layer measurement report container according to clause 5.3.5.13d:

3\> set the *measReportAppLayerContainer* in the
*MeasurementReportAppLayer* message to the received value in the
application layer measurement report container;

2\> set the *measConfigAppLayerId* in the *MeasurementReportAppLayer*
message to the value of the *measConfigAppLayerId* received together
with application layer measurement report information;

2\> if session start or stop information has been received from upper
layers for the *measConfigAppLayerId*:

3\> set the *appLayerSessionStatus* in the *MeasurementReportAppLayer*
message to the latest received value of session start or stop
information;

2\> if a RAN visible application layer measurement report has been
received from upper layers:

3\> for each *appLayerBufferLevel* value in the received RAN visible
application layer measurement report:

4\> set the *appLayerBufferLevel* values in the
*appLayerBufferLevelList* in the *MeasurementReportAppLayer* message to
the buffer level values received from the upper layer in the order with
the first *appLayerBufferLevel* value set to the newest received buffer
level value, the second *appLayerBufferLevel* value set to the second
newest received buffer level value, and so on until all the buffer level
values received from the upper layer have been assigned or the maximum
number of values have been set according to *appLayerBufferLevel*, if
configured;

3\> set the *playoutDelayForMediaStartup* in the
*MeasurementReportAppLayer* message to the received value of playout
delay for media startup in the RAN visible application layer measurement
report, if any;

3\> for each PDU session ID value indicated in the received RAN visible
application layer measurement report, if any:

> 4\> set the *PDU-SessionID* in the *pdu-SessionIdList* in the
> *MeasurementReportAppLayer* message to the indicated PDU session ID
> value;

4\> for each QoS Flow ID value indicated in the received RAN visible
application layer measurement report associated with the PDU Session ID,
if any:

5\> set the *QFI* associated with the PDU session ID to the indicated
QoS Flow ID value.

1\> if *reportingSRB* (or SRB4 if *reportingSRB* is absent) and
*ran-VisibleReportingSRB* (or SRB4 if *ran-VisibleReportingSRB* is
absent) indicates different SRBs for the *measConfigAppLayerId*:

2\> include *measReportAppLayerContainer* and *appLayerSessionStatus* in
a separate *MeasurementReportAppLayer* message than
*ran-VisibleMeasurements*;

1\> for each encoded *MeasurementReportAppLayer* message generated above
which contains either only encapsulated application layer measurement
reports or both encapsulated application layer measurement reports and
RAN visible application layer measurement reports:

2\> if *reportingSRB* is not configured for the *measConfigAppLayerId*:

3\> if the encoded RRC message is larger than the maximum supported size
of one PDCP SDU specified in TS 38.323 \[5\]:

4\> if the RRC message segmentation is enabled based on the field
*rrc-SegAllowedSRB4* received in *appLayerMeasConfig*:

5\> initiate the UL message segment transfer procedure as specified in
clause 5.7.7 for transmission via SRB4;

4\> else:

5\> discard the RRC message;

3\> else:

4\> submit the *MeasurementReportAppLayer* message to lower layers for
transmission via SRB4.

2\> else if *reportingSRB* is configured for the *measConfigAppLayerId*:

3\> if the encoded RRC message is larger than the maximum supported size
of one PDCP SDU specified in TS 38.323 \[5\]:

4\> if the RRC message segmentation is enabled based on the field
*rrc-SegAllowedSRB4* received in *appLayerMeasConfig* and the
*reportingSRB* is SRB4, or

4\> if RRC message segmentation is enabled based on the field
*rrc-SegAllowedSRB5* received in *appLayerMeasConfig* and the
*reportingSRB* is SRB5:

5\> initiate the UL message segment transfer procedure as specified in
clause 5.7.7 for transmission via the SRB indicated in the field
*reportingSRB* in *MeasConfigAppLayer*;

4\> else:

5\> discard the RRC message;

3\> else:

4\> submit the *MeasurementReportAppLayer* message to lower layers for
transmission via the SRB indicated in the field *reportingSRB* in
*MeasConfigAppLayer*.

1\> for each encoded *MeasurementReportAppLayer* message generated above
which contains only RAN visible application layer measurement reports:

2\> if *ran-VisibleReportingSRB* is not configured for the
*measConfigAppLayerId*:

3\> submit the *MeasurementReportAppLayer* message to lower layers for
transmission via SRB4;

2\> else if *ran-VisibleReportingSRB* is configured for the
*measConfigAppLayerId*:

3\> submit the *MeasurementReportAppLayer* message to lower layers for
transmission via the SRB indicated in the field
*ran-VisibleReportingSRB* in *MeasConfigAppLayer*.

NOTE 1: If the SRB indicated by *reportingSRB* is not available or if
*reportingSRB* is absent and SRB4 is not available, the UE may store
application layer measurement report containers until the SRB is
available. The UE may discard reports when the memory reserved for
storing application layer measurement report containers becomes full.
Reports with lower *appLayerMeasPriority* are discarded first. If equal
or no *appLayerMeasPriority* is configured, older reports are discarded
first.

NOTE 2: If the SRB indicated by *ran-VisibleReportingSRB* is not
available or if *ran-VisibleReportingSRB* is absent and SRB4 is not
available, the UE discards RAN visible application layer measurement
reports.