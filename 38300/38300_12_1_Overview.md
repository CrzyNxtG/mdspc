## 12.1 Overview

The **5G QoS model** is based on QoS Flows (see TS 23.501 \[3\]) and
supports both QoS Flows that require guaranteed flow bit rate (GBR QoS
Flows) and QoS Flows that do not require guaranteed flow bit rate
(non-GBR QoS Flows). At NAS level (see TS 23.501 \[3\]), the QoS flow is
thus the finest granularity of QoS differentiation in a PDU session. A
QoS flow is identified within a PDU session by a QoS Flow ID (QFI)
carried in an encapsulation header over NG-U.

The **QoS architecture** in NG-RAN, both for NR connected to 5GC and for
E-UTRA connected to 5GC, is depicted in the Figure 12-1 and described in
the following:

\- For each UE, 5GC establishes one or more PDU Sessions;

\- Except for NB-IoT, IAB-MT in SA mode, and NCR-MT, for each UE, the
NG-RAN establishes at least one Data Radio Bearers (DRB) together with
the PDU Session and additional DRB(s) for QoS flow(s) of that PDU
session can be subsequently configured (it is up to NG-RAN when to do
so);

\- If NB-IoT UE supports NG-U data transfer, the NG-RAN may establish
Data Radio Bearers (DRB) together with the PDU Session and one PDU
session maps to only one DRB;

\- The NG-RAN maps packets belonging to different PDU sessions to
different DRBs;

\- NAS level packet filters in the UE and in the 5GC associate UL and DL
packets with QoS Flows;

\- AS-level mapping rules in the UE and in the NG-RAN associate UL and
DL QoS Flows with DRBs.

![](media/image60.emf)

Figure 12-1: QoS architecture

NG-RAN and 5GC ensure quality of service (e.g. reliability and target
delay) by mapping packets to appropriate QoS Flows and DRBs. Hence there
is a 2-step mapping of IP-flows to QoS flows (NAS) and from QoS flows to
DRBs (Access Stratum).

At **NAS level**, a QoS flow is characterised by a QoS profile provided
by 5GC to NG-RAN and QoS rule(s) provided by 5GC to the UE. The QoS
profile is used by NG-RAN to determine the treatment on the radio
interface while the QoS rules dictates the mapping between uplink User
Plane traffic and QoS flows to the UE. A QoS flow may either be GBR or
Non-GBR depending on its profile. The QoS profile of a QoS flow contains
QoS parameters, for instance (see TS 23.501 \[3\]):

\- For each QoS flow:

\- A 5G QoS Identifier (5QI);

\- An Allocation and Retention Priority (ARP).

\- In case of a GBR QoS flow only:

\- Guaranteed Flow Bit Rate (GFBR) for both uplink and downlink;

\- Maximum Flow Bit Rate (MFBR) for both uplink and downlink;

\- Maximum Packet Loss Rate for both uplink and downlink;

\- Delay Critical Resource Type;

\- Notification Control.

NOTE: The Maximum Packet Loss Rate (UL, DL) is only provided for a GBR
QoS flow belonging to voice media.

\- In case of Non-GBR QoS only:

\- Reflective QoS Attribute (RQA): the RQA, when included, indicates
that some (not necessarily all) traffic carried on this QoS flow is
subject to reflective quality of service (RQoS) at NAS;

\- Additional QoS Flow Information.

The QoS parameter Notification Control indicates whether notifications
are requested from the RAN when the GFBR can no longer (or again) be
fulfilled for a QoS Flow. If, for a given GBR QoS Flow, notification
control is enabled and the RAN determines that the GFBR cannot be
guaranteed, RAN shall send a notification towards SMF and keep the QoS
Flow (i.e. while the NG-RAN is not delivering the requested GFBR for
this QoS Flow), unless specific conditions at the NG-RAN require the
release of the NG-RAN resources for this GBR QoS Flow, e.g. due to Radio
link failure or RAN internal congestion. When applicable, NG-RAN sends a
new notification, informing SMF that the GFBR can be guaranteed again.

If Alternative QoS parameters Sets are received with the Notification
Control parameter, the NG-RAN may also include in the notification a
reference corresponding to the QoS Parameter Set which it can currently
fulfil as specified in TS 23.501 \[3\]. The target NG-RAN node may
include in the notification control indication the reference to the QoS
Parameter Set which it can currently fulfil over Xn to the source NG-RAN
node during handover.

In addition, an Aggregate Maximum Bit Rate is associated to each PDU
session (Session-AMBR), to each UE (UE-AMBR) and to each slice per UE
(UE-Slice-MBR). The Session-AMBR limits the aggregate bit rate that can
be expected to be provided across all Non-GBR QoS Flows for a specific
PDU Session and is ensured by the UPF. The UE-AMBR limits the aggregate
bit rate that can be expected to be provided across all Non-GBR QoS
Flows of a UE and is ensured by the RAN (see clause 10.5.1). The
UE-Slice-MBR limits the aggregate bit rate that can be expected to be
provided across all GBR and Non-GBR QoS Flows corresponding to PDU
Sessions of the UE for the same slice (S-NSSAI) as specified in TS
23.501 \[3\] and is ensured by the RAN (see clause 10.5.1).

The 5QI is associated to QoS characteristics giving guidelines for
setting node specific parameters for each QoS Flow. Standardized or
pre-configured 5G QoS characteristics are derived from the 5QI value and
are not explicitly signalled. Signalled QoS characteristics are included
as part of the QoS profile. The QoS characteristics consist for instance
of (see TS 23.501 \[3\]):

\- Priority level;

\- Packet Delay Budget (including Core Network Packet Delay Budget);

\- Packet Error Rate;

\- Averaging window;

\- Maximum Data Burst Volume.

At **Access Stratum** level, the data radio bearer (DRB) defines the
packet treatment on the radio interface (Uu). A DRB serves packets with
the same packet forwarding treatment. The QoS flow to DRB mapping by
NG-RAN is based on QFI and the associated QoS profiles (i.e. QoS
parameters and QoS characteristics). Separate DRBs may be established
for QoS flows requiring different packet forwarding treatment, or
several QoS Flows belonging to the same PDU session can be multiplexed
in the same DRB.

In the uplink, the mapping of QoS Flows to DRBs is controlled by mapping
rules which are signalled in two different ways:

\- Reflective mapping: for each DRB, the UE monitors the QFI(s) of the
downlink packets and applies the same mapping in the uplink; that is,
for a DRB, the UE maps the uplink packets belonging to the QoS flows(s)
corresponding to the QFI(s) and PDU Session observed in the downlink
packets for that DRB. To enable this reflective mapping, the NG-RAN
marks downlink packets over Uu with QFI.

\- Explicit Configuration: QoS flow to DRB mapping rules can be
explicitly signalled by RRC.

The UE always applies the latest update of the mapping rules regardless
of whether it is performed via reflecting mapping or explicit
configuration.

When a QoS flow to DRB mapping rule is updated, the UE sends an end
marker on the old bearer.

In the downlink, the QFI is signalled by NG-RAN over Uu for the purpose
of RQoS and if neither NG-RAN, nor the NAS (as indicated by the RQA)
intend to use reflective mapping for the QoS flow(s) carried in a DRB,
no QFI is signalled for that DRB over Uu. In the uplink, NG-RAN can
configure the UE to signal QFI over Uu.

For each PDU session, a default DRB may be configured: if an incoming UL
packet matches neither an RRC configured nor a reflective mapping rule,
the UE then maps that packet to the default DRB of the PDU session. For
non-GBR QoS flows, the 5GC may send to the NG-RAN the Additional QoS
Flow Information parameter associated with certain QoS flows to indicate
that traffic is likely to appear more often on them compared to other
non-GBR QoS flows established on the same PDU session.

Within each PDU session, it is up to NG-RAN how to map multiple QoS
flows to a DRB. The NG-RAN may map a GBR flow and a non-GBR flow, or
more than one GBR flow to the same DRB, but mechanisms to optimise these
cases are not within the scope of standardization.